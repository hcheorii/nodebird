{"ast":null,"code":"var _jsxFileName = \"/Users/ihyeoncheol/Desktop/nodebird_project/prepare/front/pages/index.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport axios from \"axios\";\nimport AppLayout from \"../components/AppLayout\";\nimport PostForm from \"../components/PostForm\";\nimport PostCard from \"../components/PostCard\";\nimport { loadMyInfo } from \"../reducers/user\";\nimport { loadPosts } from \"../reducers/post\";\nimport wrapper from \"../store/configureStore\";\nfunction Home(props) {\n  var _mainPosts;\n  console.log(\"props\", props);\n  const dispatch = useDispatch();\n  const {\n    me\n  } = useSelector(state => state.user);\n  const {\n    mainPosts,\n    hasMorePosts,\n    loadPostsLoading,\n    retweetError\n  } = useSelector(state => state.post);\n  useEffect(() => {\n    if (retweetError) {\n      alert(retweetError);\n    }\n  }, [retweetError]);\n  const lastId = (_mainPosts = mainPosts[mainPosts.length - 1]) === null || _mainPosts === void 0 ? void 0 : _mainPosts.id;\n  useEffect(() => {\n    function onScroll() {\n      if (window.pageYOffset + document.documentElement.clientHeight > document.documentElement.scrollHeight - 300) {\n        if (hasMorePosts && !loadPostsLoading) {\n          dispatch(loadPosts(lastId));\n        }\n      }\n    }\n    window.addEventListener(\"scroll\", onScroll);\n    return () => {\n      window.removeEventListener(\"scroll\", onScroll);\n    };\n  }, [hasMorePosts, loadPostsLoading, mainPosts]);\n  return __jsx(AppLayout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 9\n    }\n  }, me && __jsx(PostForm, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 20\n    }\n  }), mainPosts.map(post => __jsx(PostCard, {\n    key: post.id,\n    post: post,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 17\n    }\n  })));\n}\n\n// SSR (프론트 서버에서 실행)\nexport const getServerSideProps = wrapper.getServerSideProps(store => async ({\n  req\n}) => {\n  const cookie = req ? req.headers.cookie : \"\";\n  axios.defaults.headers.Cookie = \"\";\n  // 쿠키가 브라우저에 있는경우만 넣어서 실행\n  // (주의, 아래 조건이 없다면 다른 사람으로 로그인 될 수도 있음)\n  if (req && cookie) {\n    axios.defaults.headers.Cookie = cookie;\n  }\n  await store.dispatch(loadPosts());\n  await store.dispatch(loadMyInfo());\n  console.log(\"state\", store.getState());\n});\nexport function reportWebVitals(metric) {\n  console.log(metric);\n}\nexport default Home;","map":{"version":3,"names":["React","useEffect","useSelector","useDispatch","axios","AppLayout","PostForm","PostCard","loadMyInfo","loadPosts","wrapper","Home","props","_mainPosts","console","log","dispatch","me","state","user","mainPosts","hasMorePosts","loadPostsLoading","retweetError","post","alert","lastId","length","id","onScroll","window","pageYOffset","document","documentElement","clientHeight","scrollHeight","addEventListener","removeEventListener","__jsx","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","map","key","getServerSideProps","store","req","cookie","headers","defaults","Cookie","getState","reportWebVitals","metric"],"sources":["/Users/ihyeoncheol/Desktop/nodebird_project/prepare/front/pages/index.js"],"sourcesContent":["import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport axios from \"axios\";\n\nimport AppLayout from \"../components/AppLayout\";\nimport PostForm from \"../components/PostForm\";\nimport PostCard from \"../components/PostCard\";\nimport { loadMyInfo } from \"../reducers/user\";\nimport { loadPosts } from \"../reducers/post\";\nimport wrapper from \"../store/configureStore\";\n\nfunction Home(props) {\n    console.log(\"props\", props);\n    const dispatch = useDispatch();\n    const { me } = useSelector((state) => state.user);\n    const { mainPosts, hasMorePosts, loadPostsLoading, retweetError } =\n        useSelector((state) => state.post);\n\n    useEffect(() => {\n        if (retweetError) {\n            alert(retweetError);\n        }\n    }, [retweetError]);\n\n    const lastId = mainPosts[mainPosts.length - 1]?.id;\n    useEffect(() => {\n        function onScroll() {\n            if (\n                window.pageYOffset + document.documentElement.clientHeight >\n                document.documentElement.scrollHeight - 300\n            ) {\n                if (hasMorePosts && !loadPostsLoading) {\n                    dispatch(loadPosts(lastId));\n                }\n            }\n        }\n\n        window.addEventListener(\"scroll\", onScroll);\n        return () => {\n            window.removeEventListener(\"scroll\", onScroll);\n        };\n    }, [hasMorePosts, loadPostsLoading, mainPosts]);\n    return (\n        <AppLayout>\n            {me && <PostForm />}\n            {mainPosts.map((post) => (\n                <PostCard key={post.id} post={post} />\n            ))}\n        </AppLayout>\n    );\n}\n\n// SSR (프론트 서버에서 실행)\nexport const getServerSideProps = wrapper.getServerSideProps(\n    (store) =>\n        async ({ req }) => {\n            const cookie = req ? req.headers.cookie : \"\";\n            axios.defaults.headers.Cookie = \"\";\n            // 쿠키가 브라우저에 있는경우만 넣어서 실행\n            // (주의, 아래 조건이 없다면 다른 사람으로 로그인 될 수도 있음)\n            if (req && cookie) {\n                axios.defaults.headers.Cookie = cookie;\n            }\n            await store.dispatch(loadPosts());\n            await store.dispatch(loadMyInfo());\n            console.log(\"state\", store.getState());\n        }\n);\n\nexport function reportWebVitals(metric) {\n    console.log(metric);\n}\n\nexport default Home;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}