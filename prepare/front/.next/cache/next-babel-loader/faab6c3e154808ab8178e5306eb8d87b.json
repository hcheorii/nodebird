{"ast":null,"code":"var _jsxFileName = \"/Users/ihyeoncheol/Desktop/nodebird_project/prepare/front/pages/index.js\",\n  _s = $RefreshSig$();\nvar __jsx = React.createElement;\nimport React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport AppLayout from \"../components/AppLayout\";\nimport PostForm from \"../components/PostForm\";\nimport PostCard from \"../components/PostCard\";\nimport { loadPosts } from \"../reducers/post\";\nfunction Home(props) {\n  _s();\n  var _mainPosts,\n    _this = this;\n  console.log(\"props\", props);\n  var dispatch = useDispatch();\n  var _useSelector = useSelector(function (state) {\n      return state.user;\n    }),\n    me = _useSelector.me;\n  var _useSelector2 = useSelector(function (state) {\n      return state.post;\n    }),\n    mainPosts = _useSelector2.mainPosts,\n    hasMorePosts = _useSelector2.hasMorePosts,\n    loadPostsLoading = _useSelector2.loadPostsLoading,\n    retweetError = _useSelector2.retweetError;\n  useEffect(function () {\n    if (retweetError) {\n      alert(retweetError);\n    }\n  }, [retweetError]);\n  var lastId = (_mainPosts = mainPosts[mainPosts.length - 1]) === null || _mainPosts === void 0 ? void 0 : _mainPosts.id;\n  useEffect(function () {\n    function onScroll() {\n      if (window.pageYOffset + document.documentElement.clientHeight > document.documentElement.scrollHeight - 300) {\n        if (hasMorePosts && !loadPostsLoading) {\n          dispatch(loadPosts(lastId));\n        }\n      }\n    }\n    window.addEventListener(\"scroll\", onScroll);\n    return function () {\n      window.removeEventListener(\"scroll\", onScroll);\n    };\n  }, [hasMorePosts, loadPostsLoading, mainPosts]);\n  return __jsx(AppLayout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 9\n    }\n  }, me && __jsx(PostForm, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 20\n    }\n  }), mainPosts.map(function (post) {\n    return __jsx(PostCard, {\n      key: post.id,\n      post: post,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 17\n      }\n    });\n  }));\n}\n\n// SSR (프론트 서버에서 실행)\n_s(Home, \"djuFENDcsI0GwSBhrXT69nwI2y0=\", false, function () {\n  return [useDispatch, useSelector, useSelector];\n});\n_c = Home;\nexport var __N_SSP = true;\nexport function reportWebVitals(metric) {\n  console.log(metric);\n}\nexport default Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","useEffect","useSelector","useDispatch","AppLayout","PostForm","PostCard","loadPosts","Home","props","_s","_mainPosts","_this","console","log","dispatch","_useSelector","state","user","me","_useSelector2","post","mainPosts","hasMorePosts","loadPostsLoading","retweetError","alert","lastId","length","id","onScroll","window","pageYOffset","document","documentElement","clientHeight","scrollHeight","addEventListener","removeEventListener","__jsx","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","map","key","_c","__N_SSP","reportWebVitals","metric","$RefreshReg$"],"sources":["/Users/ihyeoncheol/Desktop/nodebird_project/prepare/front/pages/index.js"],"sourcesContent":["import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport axios from \"axios\";\n\nimport AppLayout from \"../components/AppLayout\";\nimport PostForm from \"../components/PostForm\";\nimport PostCard from \"../components/PostCard\";\nimport { loadMyInfo } from \"../reducers/user\";\nimport { loadPosts } from \"../reducers/post\";\nimport wrapper from \"../store/configureStore\";\n\nfunction Home(props) {\n    console.log(\"props\", props);\n    const dispatch = useDispatch();\n    const { me } = useSelector((state) => state.user);\n    const { mainPosts, hasMorePosts, loadPostsLoading, retweetError } =\n        useSelector((state) => state.post);\n\n    useEffect(() => {\n        if (retweetError) {\n            alert(retweetError);\n        }\n    }, [retweetError]);\n\n    const lastId = mainPosts[mainPosts.length - 1]?.id;\n    useEffect(() => {\n        function onScroll() {\n            if (\n                window.pageYOffset + document.documentElement.clientHeight >\n                document.documentElement.scrollHeight - 300\n            ) {\n                if (hasMorePosts && !loadPostsLoading) {\n                    dispatch(loadPosts(lastId));\n                }\n            }\n        }\n\n        window.addEventListener(\"scroll\", onScroll);\n        return () => {\n            window.removeEventListener(\"scroll\", onScroll);\n        };\n    }, [hasMorePosts, loadPostsLoading, mainPosts]);\n    return (\n        <AppLayout>\n            {me && <PostForm />}\n            {mainPosts.map((post) => (\n                <PostCard key={post.id} post={post} />\n            ))}\n        </AppLayout>\n    );\n}\n\n// SSR (프론트 서버에서 실행)\nexport const getServerSideProps = wrapper.getServerSideProps(\n    (store) =>\n        async ({ req }) => {\n            const cookie = req ? req.headers.cookie : \"\";\n            axios.defaults.headers.Cookie = \"\";\n            // 쿠키가 브라우저에 있는경우만 넣어서 실행\n            // (주의, 아래 조건이 없다면 다른 사람으로 로그인 될 수도 있음)\n            if (req && cookie) {\n                axios.defaults.headers.Cookie = cookie;\n            }\n            await store.dispatch(loadPosts());\n            await store.dispatch(loadMyInfo());\n            console.log(\"state\", store.getState());\n        }\n);\n\nexport function reportWebVitals(metric) {\n    console.log(metric);\n}\n\nexport default Home;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}